      
      // Event listeners para updates
      document.getElementById('updates-btn').addEventListener('click', showUpdates);
      
      // Event listeners para temas
      document.getElementById('theme-panel-btn').addEventListener('click', showThemePanel);
      document.getElementById('close-theme-panel').addEventListener('click', hideThemePanel);
      document.getElementById('theme-overlay').addEventListener('click', hideThemePanel);
      
      document.querySelectorAll('.theme-card').forEach(card => {
        card.addEventListener('click', (e) => {
          const theme = e.target.closest('.theme-card').dataset.theme;
          const cost = parseInt(card.dataset.cost);
          
          if (card.classList.contains('premium-theme') && !gameData.unlockedThemes.has(theme)) {
            if (buyTheme(theme, cost)) {
              setTheme(theme);
              hideThemePanel();
              if (theme === 'custom') showCustomColors();
            } else {
              alert(`Necesitas ${cost} puntos para desbloquear este tema. Tienes ${gameData.points} puntos.`);
              return;
            }
          } else {
            setTheme(theme);
            hideThemePanel();
            if (theme === 'custom') showCustomColors();
          }
          
          // Marcar que el usuario cambiÃ³ tema manualmente hoy
          localStorage.setItem('last-theme-change', new Date().toDateString());
          
          // Sistema de logros para temas
          gameData.themesUsed.add(theme);
          gameData.themeChangeCount++;
          updateChallenge('change-theme');
          updateWeeklyChallenge('theme-explorer');
          updateBadgeProgress('theme-master', 1);
          updateBadgeProgress('customization', 1);
          
          if (gameData.themesUsed.size === 1) checkAchievement('theme-explorer');
          if (gameData.themesUsed.size >= 5) checkAchievement('theme-collector');
          if (gameData.themeChangeCount >= 20) checkAchievement('theme-addict');
          if (theme === 'funkyatlas' || theme === 'funkyatlas-christmas') {
            checkAchievement('funky-fan');
            showCreditsPanel();
          }
          if (theme === 'legendary') {
            checkAchievement('legendary-hunter');
          }
          
          // Verificar si todos los logros estÃ¡n completos
          const allAchievements = Object.keys(achievements);
          const completedAchievements = allAchievements.filter(id => gameData.achievements[id]);
          if (completedAchievements.length === allAchievements.length - 1) { // -1 porque perfectionist se completa al final
            checkAchievement('perfectionist');
          }
          
          saveGameData();
        });
      });
      
      // Event listeners para logros - ARREGLADO
      const achievementsBtn = document.getElementById('achievements-btn');
      if (achievementsBtn) {
        achievementsBtn.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          const panel = document.getElementById('achievements-panel');
          if (panel) {
            if (panel.classList.contains('show')) {
              panel.classList.remove('show');
            } else {
              panel.classList.add('show');
              if (typeof plushieSystem !== 'undefined' && plushieSystem) {
                plushieSystem.updateEventBadge();
              }
            }
          }
        });
      }
      const closeAchievements = document.getElementById('close-achievements');
      if (closeAchievements) {
        closeAchievements.addEventListener('click', () => {
          const panel = document.getElementById('achievements-panel');
          if (panel) {
            panel.classList.remove('show');
          }
        });
      }
      
      // Event listeners para cursores
      document.querySelectorAll('.cursor-item').forEach(item => {
        item.addEventListener('click', (e) => {
          const cursor = e.target.closest('.cursor-item').dataset.cursor;
          const cost = parseInt(item.dataset.cost) || 0;
          
          if (item.classList.contains('locked') && cost > 0) {
            if (buyCursor(cursor, cost)) {
              setCursor(cursor);
            } else {
              alert(`Necesitas ${cost} puntos para este cursor. Tienes ${gameData.points} puntos.`);
            }
          } else if (gameData.unlockedCursors.has(cursor)) {
            setCursor(cursor);
            updateCursorShop();
          }
        });
      });
      
      // Event listener para colores custom
      const applyCustomBtn = document.getElementById('apply-custom');
      if (applyCustomBtn) {
        applyCustomBtn.addEventListener('click', () => {
          gameData.customColors.bg = document.getElementById('bg-color').value;
          gameData.customColors.text = document.getElementById('text-color').value;
          gameData.customColors.primary = document.getElementById('primary-color').value;
          gameData.customColors.secondary = document.getElementById('secondary-color').value;
          
          applyCustomTheme();
          saveGameData();
          
          showAchievementNotification({ name: 'Colores personalizados aplicados!', points: 0 });
        });
      }
      
      // Event listeners para checkboxes
      const autoSeasonalCheckbox = document.getElementById('auto-seasonal');
      if (autoSeasonalCheckbox) {
        autoSeasonalCheckbox.checked = gameData.autoSeasonalThemes;
        autoSeasonalCheckbox.addEventListener('change', (e) => {
